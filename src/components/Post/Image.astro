---
import { getImage } from 'astro:assets'
import { averageColorFromURL } from '../../lib/images'

interface Props {
  alt: string
  src: ImageMetadata | string
}

const { alt, src } = Astro.props
const img = await getImage({
  src: src,
  format: 'webp',
  quality: 90,
  inferSize: true,
})
let fileUrl = typeof src === 'string' ? new URL(src) : new URL(src.src.replace('/@fs', ''), img.src.startsWith('http') ? undefined : 'file:/')
const backgroundColor = await averageColorFromURL(fileUrl.pathname)
---

<img
  src={img.src}
  width={img.options.width}
  height={img.options.height}
  alt={alt}
  style={{ backgroundColor }}
  decoding="async"
  loading="lazy"
  class:list={['max-w-100', 'mx-auto']}
/>
