---
import { getCollection, render, type CollectionEntry } from 'astro:content'
import PostLayout from '../../layouts/Post.astro'
import { readingTimeToFancyBackgroundPoints } from '../../lib/utils'
import { components } from '../../components/Post/components.astro'

interface Props {
  entry: CollectionEntry<'blog'>
}

export async function getStaticPaths() {
  return (await getCollection('blog')).map((entry) => ({
    params: {
      slug: entry.slug,
    },
    props: {
      entry,
    },
  }))
}

const { entry } = Astro.props
const {
  Content,
  remarkPluginFrontmatter,
  // @ts-expect-error components is returned here, so I don't know why it's typed wrong
  components: mdxComponents,
} = await render(entry)
---

<PostLayout
  collection={entry.collection}
  slug={entry.slug}
  frontmatter={entry.data}
  remarkPluginFrontmatter={remarkPluginFrontmatter}
  showComments
  fancyBackgroundPoints={readingTimeToFancyBackgroundPoints(
    remarkPluginFrontmatter.readingTime
  )}
>
  <Content components={{ ...components, ...mdxComponents }} />
</PostLayout>
