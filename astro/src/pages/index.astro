---
import { Image } from '@astrojs/image/components'
import Layout from '../layouts/Layout.astro'
import EmojiText from '../components/EmojiText.astro'
import DaylioEntry from '../components/DaylioEntry.astro'
import DaylioChart from '../components/DaylioChart.tsx'
import GithubCalendar from '../components/GithubCalendar.astro'
import lastfm from '../lib/lastfm'
import goodreads from '../lib/goodreads'
import daylio from '../lib/daylio'
import config from '../config'

const latestEntry = await daylio.getLatest()
const topAlbums = (await lastfm.getTopAlbumsCover(config.lastFmUsername)).slice(
  0,
  9
)
const shelves = {
  current: await goodreads.getShelf({
    userID: config.goodreadsUserID,
    shelf: 'currently-reading',
    limit: 1,
  }),
  read: await goodreads.getShelf({
    userID: config.goodreadsUserID,
    shelf: 'read',
    limit: 11,
    sort: 'date_read',
    order: 'd',
  }),
}
---

<Layout>
  <section class="intro paper prose">
    <h2>Glad To Meet You!</h2>
    <figure
      class:list={[
        'float-right',
        'ml-8',
        'hidden',
        'sm:block',
        'w-[250px]',
        'h-[250px]',
      ]}
    >
      <Image
        src={import('../assets/img/eli-thumbs-up-memoji.png')}
        loading="eager"
        alt="Eli Gundry's Memoji Headshot"
        width="250"
        height="250"
        format="webp"
      />
    </figure>
    <p>My name is Eli I only really write in lists, so here's my deal.</p>
    <ul>
      <li>
        I am a{' '}
        <EmojiText emoji="ðŸ§‘â€ðŸ’»" label="computer programmer emoji">
          <strong>full stack web engineer</strong>.
        </EmojiText>
      </li>
      <li>
        I love to plan and{' '}
        <EmojiText emoji="ðŸ‘¨â€ðŸ³" label="chef emoji">
          <strong>cook elaborate meals</strong>.
        </EmojiText>
        It really activates the engineering part of my brain!
      </li>
      <li>
        I have a{' '}
        <EmojiText emoji="ðŸ¤“" label="geek emoji">
          <strong>non-traditional computer science education</strong>.
        </EmojiText>
        I attended a vocational school in high school, taught myself web programming,
        bounced around colleges for computer science while working the entire time
        before deciding to go pro!
      </li>
      <li>
        I am a
        <strong>Vim user</strong> but I actively encourage everyone to use something
        else. Using Vim in {new Date().getFullYear()} is a cool bar trick.
      </li>
      <li>
        I currently live in{' '}
        <EmojiText emoji="ðŸ“" label="pin emoji to denote location">
          <strong>Astoria, Queens</strong>.
        </EmojiText>
        I didn't think I would settle down in Queens and love it as much as I do,
        but life is like that sometimes.
      </li>
      <li>
        I have a{' '}
        <EmojiText
          emoji="ðŸ˜¼"
          label="smirking cat emoji because Fonzie is a stinker"
        >
          <strong>fat cat named Fonzie</strong>
        </EmojiText>{' '}
        and I sorta have{' '}
        <a href="https://twitter.com/EliGundry/status/1055933062125703168">
          a tattoo of him on my arm</a
        >.
      </li>
    </ul>
  </section>

  <section class="daylio paper prose">
    <h2>How I'm Feeling</h2>
    <p>
      A while ago, I decided to start journaling my feelings. Being a software
      engineer,
      <a href="/blog/feelings-api"
        >I made an API out of it and put it on my website</a
      >. The favicon for the site the emoji for my latest entry.
    </p>
    <DaylioEntry entry={latestEntry} />
    <DaylioChart client:media="(min-width: 640px)" />
  </section>

  <section class="coding paper prose">
    <h2>Do You Code?</h2>
    <p>
      I make a living developing web applications. I jump all around the stack
      and will do whatever it takes to ship. Need me to do some devops to get
      this feature out? I gotcha. Some CSS is making a button look bad? I'll do
      my best. A query running to slow? Stop, I can't deal with all this
      excitement.
    </p>
    <p>
      GitHub contribution calendars are not a good indicator of whether or not
      someone is a good developer, but they are very pretty.
    </p>
    <GithubCalendar />
  </section>

  <section class="reading paper prose">
    <h2>What I'm Reading</h2>
    <p>
      I wish I read more, but there are only so many hours in the day. These are
      the books that I'm reading right now. You can find me on <a
        href="https://www.goodreads.com/user/show/29665939-eli-gundry"
        itemprop="sameAs">Goodreads</a
      >.
    </p>
    <div class="bookshelf not-prose gap-y-2 [&>a]:tooltip">
      {
        [...shelves.current, ...shelves.read].map((book, i) => {
          let alt = book.title

          if (book.author) {
            alt += ` by ${book.author.split(', ').reverse().join(' ')}`
          }

          if (i === 0) {
            alt = `Currently Reading: ${alt}`
          }

          return (
            <a
              href={book.url}
              target="_blank"
              rel="noopener noreferrer"
              data-tip={alt}
            >
              <Image
                alt={alt}
                src={book.cover}
                loading="lazy"
                width={100}
                height={160}
                quality={90}
                format="webp"
                decoding="async"
                style={{ backgroundColor: book.coverColor }}
              />
            </a>
          )
        })
      }
    </div>
  </section>

  <section class="listening paper prose">
    <h2>What I'm Listening To</h2>
    <p>
      I listen to way too much music and I love to listen to full albums. I
      mainly listen to hip hop, indie rock and
      <a href="/blog/icymi-glocca-morra-just-married">emo</a>. I occasionally
      write reviews of old albums that I love but aren't well known in a series
      called
      <a href="/tags/icymi"><abbr title="I See You Missed It">ICYMI</abbr></a>.
    </p>
    <div class="flex flex-col sm:flex-row sm:gap-4">
      <div class="sm:items-stretch flex flex-col">
        <h3 class="mt-0">Seasonal Playlist</h3>
        <iframe
          title="Spotify playlist that I have on repeat"
          src={config.spotifyPlaylist}
          frameborder="0"
          allow="encrypted-media"
          loading="lazy"
          class="w-full sm:w-[300px] h-[380px] sm:flex-1"></iframe>
      </div>
      <div>
        <h3 class="mt-2 sm:mt-0">On Repeat</h3>
        <a
          href="https://www.last.fm/user/eli_pwnd"
          class="grid grid-cols-3 h-fit gap-0 not-prose [&>picture]:tooltip"
        >
          {
            topAlbums.map((album) => {
              const alt = `${album.album} by ${album.artist} [${album.count} scrobbles]`
              return (
                <picture data-tip={alt}>
                  <Image
                    alt={alt}
                    src={album.cover}
                    width={146}
                    height={146}
                    quality={90}
                    format="webp"
                    loading="lazy"
                    decoding="async"
                    style={{ backgroundColor: album.coverColor ?? undefined }}
                  />
                </picture>
              )
            })
          }
        </a>
      </div>
    </div>
  </section>
</Layout>
