---
import clsx from 'clsx'
import EmojiText from '../components/EmojiText.astro'

const links = [
  {
    name: 'Home',
    href: '/',
    emoji: '🏠',
    emojiLabel: 'little house to denote the home page',
  },
  {
    name: 'Blog',
    href: '/blog/',
    emoji: '📝',
    emojiLabel: 'note to denote my blog',
  },
  {
    name: 'Feelings',
    href: '/feelings/',
    emoji: '🥺',
    emojiLabel: 'emotional looking emoji face to denote my feelings',
  },
  {
    name: 'Talks',
    href: '/talks/',
    emoji: '🗣',
    emojiLabel: 'silhouette of person speaking',
  },
  {
    name: 'Resume',
    href: '/resume/',
    emoji: '📄',
    emojiLabel: 'piece of paper representing my resume',
  },
]
---

<progress
  id="scroll-progress"
  aria-label="your scroll progress through the page"
  class={clsx(
    'progress',
    'progress-primary',
    'w-full',
    'm-0',
    'fixed',
    'top-0',
    'z-50',
    'rounded-none'
  )}
  value="0"
  max="100"></progress>
<header
  class={clsx([
    'navbar',
    'bg-base-200',
    'shadow',
    'fixed',
    'top-0',
    'z-40',
    'sm:pr-8',
    'pl-4 md:pl-14',
    'print-hidden',
    '[&_a]:hover:bg-transparent',
    '[&_a]:focus:bg-transparent',
    '[&_a]:hover:no-underline',
    '[&_a]:focus:no-underline',
  ])}
>
  <div class="container mx-auto flex flex-wrap">
    <div class="flex-1">
      <a
        href="/"
        itemprop="sameAs"
        class="btn btn-ghost normal-case text-xl site-name pl-0">Eli Gundry</a
      >
    </div>
    <nav class="flex-none hidden md:flex">
      <ul class={clsx('menu', 'menu-horizontal', 'p-0', '[&_a]:text-current')}>
        {
          links.map((link) => (
            <li>
              <a
                href={link.href}
                class={clsx('hover:link-primary', 'focus:link-primary')}
              >
                <EmojiText emoji={link.emoji} label={link.emojiLabel}>
                  {link.name}
                </EmojiText>
              </a>
            </li>
          ))
        }
        <li class="items-center">
          <label class="swap swap-flip btn-sm text-2xl">
            <input
              type="checkbox"
              class="theme-toggle"
              data-toggle-theme="dark,light"
            />
            <div class="swap-on">🌚</div>
            <div class="swap-off">🌞</div>
          </label>
        </li>
      </ul>
    </nav>
    <div class="flex justify-end flex-none">
      <nav class="navbar-end md:hidden btn-group">
        <label class="swap swap-flip btn btn-sm btn-ghost text-2xl">
          <input
            type="checkbox"
            class="theme-toggle"
            data-toggle-theme="dark,light"
          />
          <div class="swap-on">🌚</div>
          <div class="swap-off">🌞</div>
        </label>
        <label
          class="swap swap-flip btn btn-sm btn-ghost text-2xl"
          tabindex="0"
          for="mobile-nav-modal-control"
        >
          <input
            type="checkbox"
            id="mobile-nav-modal-control"
            class="modal-control-input"
          />
          <div class="swap-on">🙅‍♂️</div>
          <div class="swap-off">🍔</div>
        </label>
      </nav>
    </div>
  </div>
</header>

<input
  type="checkbox"
  id="mobile-nav-modal"
  class="modal-toggle modal-control-input"
/>
<label for="mobile-nav-modal" class="modal cursor-pointer bg-transparent">
  <label
    class={clsx(
      'modal-box',
      'w-full',
      'max-w-full',
      'absolute',
      'top-[4rem]',
      'rounded-t-none',
      'bg-base-200',
      'shadow-none',
      'pt-0',
      'pl-4'
    )}
    for=""
  >
    <ul>
      {
        links.map((link) => (
          <li>
            <a
              href={link.href}
              class={clsx('hover:link-primary', 'focus:link-primary')}
            >
              <EmojiText emoji={link.emoji} label={link.emojiLabel}>
                {link.name}
              </EmojiText>
            </a>
          </li>
        ))
      }
    </ul>
  </label>
</label>

<script>
  import { on } from 'delegated-events'
  import { themeChange } from 'theme-change'
  themeChange()

  document.addEventListener('DOMContentLoaded', () => {
    themeChange()

    const themeCheckboxes = document.querySelectorAll('.theme-toggle')

    themeCheckboxes.forEach((cb) => {
      if (!('checked' in cb)) {
        return
      }

      cb.checked = document.documentElement.dataset?.theme === 'dark'
    })

    on('change', '.theme-toggle', (event) => {
      themeCheckboxes.forEach((cb) => {
        cb.checked = event.target.checked
      })
    })
  })
</script>

<script>
  const progress = document.getElementById('scroll-progress')

  function animateProgress() {
    requestAnimationFrame(() => {
      progress.value = window.scrollY
      progress.max =
        Math.max(document.body.clientHeight, window.innerHeight + 1) -
        window.innerHeight
    })
  }

  document.addEventListener('DOMContentLoaded', animateProgress)
  document.addEventListener('scroll', animateProgress)
  document.addEventListener('resize', animateProgress)
</script>

<script>
  import { on } from 'delegated-events'

  document.addEventListener('DOMContentLoaded', () => {
    on('change', '.modal-control-input', (event) => {
      const inputs = document.querySelectorAll('.modal-control-input')

      inputs.forEach((i) => {
        i.checked = event.target.checked
      })
    })
  })
</script>
